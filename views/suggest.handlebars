<!doctype html>

<html>
{{> html-header}}

<body>
	{{> navbar}}
	Suggested Foods
	{{> navbar-hack}}

	<div class="container" align="center">

		<br/>

		<div class="input-group">
			<input id="rest" type="text" class="form-control" aria-label="my location" placeholder="Choose a Restaurant">
			<span class="input-group-btn">
				<button class="btn btn-default" type="button" data-toggle="modal" data-target="#popup">
					<span class="glyphicon glyphicon-glyphicon glyphicon-map-marker"></span>
				</button>
			</span>
		</div>
		
		<br/>

		<div class="container-fluid" id="page" style="display:none;">
			<h5 style="color:#8382BF; margin-bottom:1px;">You're low on protein!</h5>
			<a onclick="wth()">Refresh</a> suggestions below.
			<br/><br/>
			<div class="row" style="margin-left:10px;">
				<div onClick="toggle(1)">
					<div class="col-xs-5" id="card1" style="border: 4px solid lightgray;" align="center">
						<h4 id="food1-name"></h4>
						<input type="hidden" id="fi1" name="food1" readonly>
						<!-- cap to 100%? -->
						<div class="progress" style="margin-bottom:5px"> fat
							<div id="food1-fat" class="progress-bar" role="progressbar" style="width:40%" style="display:inline;">
							</div>
						</div>
						<div class="progress" style="margin-bottom:5px"> protein
							<div id="food1-protein" class="progress-bar" role="progressbar" style="width:70%">
							</div>
						</div>
					</div>
				</div>
				<div onClick="toggle(2)">
					<div class="col-xs-5" id="card2" style="border: 4px solid lightgray;" align="center">
						<h4 id="food2-name"></h4>
						<input type="hidden" id="fi2" name="food2" readonly>
						<div class="progress" style="margin-bottom:5px">
							<div id="food2-fat" class="progress-bar" role="progressbar" style="width:80%" style="display:inline;"> fat
							</div>
						</div>
						<div class="progress" style="margin-bottom:5px">
							<div id="food2-protein" class="progress-bar" role="progressbar" style="width:30%"> protein
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="suggestions" style="display:none;">
			<br/>
			<form id="addSuggestedMealForm" role="form" method="get" action="/history">
				<input type="number" placeholder="Servings" name="servings1" min="1" style="width:120px; margin-bottom:10px;">
				<br/>
				<input type="text" id="datepicker" placeholder="Date of Meal" name="date">
				<select id="mealtype" name="t" style="width:90px">
					<option value="Breakfast" selected>Breakfast</option>
					<option value="Brunch">Brunch</option>
					<option value="Lunch">Lunch</option>
					<option value="Dinner">Dinner</option>
					<option value="Snack">Snack</option>
				</select>
				<br/>
				<br/>
				<input type="submit" id="submitBtn" class="btn btn-primary" value="Add Suggested Meal"></input>
			</form>
			<br/>
		</div>

		{{> icon-panel}}

		<div class="modal fade" id="popup" {{> popup}}
			Choose Nearby Restaurant
				</h4> </div> <div class="modal-body">
			<input type="radio" name="group1" value="Rubios"> Rubio's<br>
			<input type="radio" name="group1" value="Panda Express"> Panda Express<br>
				</div> <div class="modal-footer">
			<button type="button" class="btn" data-dismiss="modal">Select
		{{> popup-hack}}

	</div>

	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
	<script src="js/jquery-1.11.0.js"></script>
	<script src="js/bootstrap.js"></script>
	<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	<script src="js/nutrition-check.js"></script>
	<script>
		$("#rest").autocomplete({source: ["Rubio's", "Panda Express"]});
		function update_suggestions(result) {
			document.getElementById("food1-name").innerHTML = result["name"];
			var reqs = [2000, 65, 50, 25];
			var fp = (result["total_fat"]*100)/reqs[1];
			var p = (result["protein"]*100)/reqs[2];
			// console.log(fp);
			// console.log(p);
			document.getElementById("food1-fat").setAttribute("style", "width:"+fp+"%;");
			document.getElementById("food1-protein").setAttribute("style", "width:"+p+"%;");
			var re = $("#rest")[0].value;
			if (re == "Rubio's") re = "Rubios";
			$.get("/data/dishes/"+re, update2);
		}
		function update2(result) {
			document.getElementById("food2-name").innerHTML = result["name"];
			var reqs = [2000, 65, 50, 25];
			var fp = (result["total_fat"]*100)/reqs[1];
			var p = (result["protein"]*100)/reqs[2];
			// console.log(fp);
			// console.log(p);
			document.getElementById("food2-fat").setAttribute("style", "width:"+fp+"%;");
			document.getElementById("food2-protein").setAttribute("style", "width:"+p+"%;");
		}
		function wth() {
			var re = $("#rest")[0].value;
			if (re == "Rubio's") re = "Rubios";
			$.get("/data/dishes/"+re, update_suggestions);
		}
		$('#rest').on("autocompletechange", function() {
			var re = $(this)[0].value;
			if (re == "Rubio's") re = "Rubios";
			$.get("/data/dishes/"+re, update_suggestions);
			$("#page").fadeIn();
			$(".suggestions").fadeIn();
		});

		// identify drinks and don't suggest them!

		function toggle(num) {
			if(num == 2) {
				if (document.getElementById("fi2").name == "food1") {
					// var random_color = '#'+Math.floor(Math.random()*16777215).toString(16);
					document.getElementById("card2").setAttribute("style","border: 4px solid #73AD21;");
				} else {
					document.getElementById("card2").setAttribute("style","border: 4px solid #73AD21;");
					document.getElementById("card1").setAttribute("style","border: 4px solid lightgray;");
					document.getElementById("fi2").setAttribute("name","food1");
					document.getElementById("fi2").setAttribute("style","margin-bottom:10px; width:85px; background-color:#d1d1d1");
					document.getElementById("fi1").setAttribute("name","ignored");
					document.getElementById("fi1").setAttribute("style","margin-bottom:10px; width:85px;");
				}
			} else {
				if (document.getElementById("fi1").name == "food1") {
					// var random_color = '#'+Math.floor(Math.random()*16777215).toString(16);
					document.getElementById("card1").setAttribute("style","border: 4px solid #73AD21;");
				} else {
					document.getElementById("card1").setAttribute("style","border: 4px solid #73AD21;");
					document.getElementById("card2").setAttribute("style","border: 4px solid lightgray;");
					document.getElementById("fi1").setAttribute("name","food1");
					document.getElementById("fi1").setAttribute("style","margin-bottom:10px; width:85px; background-color:#d1d1d1;");
					document.getElementById("fi2").setAttribute("name","ignored");
					document.getElementById("fi2").setAttribute("style","margin-bottom:10px; width:85px;");
				}
			}
		}

    	// document.getElementById("suggest-iconbar").setAttribute("class","btn btn-secondary btn-sm navbar-btn");
    	// document.getElementById("suggest-link").setAttribute("href","#");
	</script>
</body>
</html>
