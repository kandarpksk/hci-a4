<!doctype html>

<html>
{{> html-header}}

<body>
	<nav class="navbar navbar-default navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header" align="right">
				<a class="navbar-brand" href="#">
					<img alt="N" src="" style="width:20px;"> <!-- data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAA81BMVEX///9VPnxWPXxWPXxWPXxWPXxWPXxWPXz///9hSYT6+vuFc6BXPn37+vz8+/z9/f2LeqWMe6aOfqiTg6uXiK5bQ4BZQX9iS4VdRYFdRYJfSINuWI5vWY9xXJF0YJR3Y5Z4ZZd5ZZd6Z5h9apq0qcW1qsW1q8a6sMqpnLyrn76tocCvpMGwpMJoUoprVYxeRoJjS4abjLGilLemmbrDutDFvdLPx9nX0eDa1OLb1uPd1+Td2OXe2eXh3Ofj3+nk4Orl4evp5u7u7PLv7fPx7/T08vb08/f19Pf29Pj39vn6+fuEcZ9YP35aQn/8/P1ZQH5fR4PINAOdAAAAB3RSTlMAIWWOw/P002ipnAAAAPhJREFUeF6NldWOhEAUBRvtRsfdfd3d3e3/v2ZPmGSWZNPDqScqqaSBSy4CGJbtSi2ubRkiwXRkBo6ZdJIApeEwoWMIS1JYwuZCW7hc6ApJkgrr+T/eW1V9uKXS5I5GXAjW2VAV9KFfSfgJpk+w4yXhwoqwl5AIGwp4RPgdK3XNHD2ETYiwe6nUa18f5jYSxle4vulw7/EtoCdzvqkPv3bn7M0eYbc7xFPXzqCrRCgH0Hsm/IjgTSb04W0i7EGjz+xw+wR6oZ1MnJ9TWrtToEx+4QfcZJ5X6tnhw+nhvqebdVhZUJX/oFcKvaTotUcvUnY188ue/n38AunzPPE8yg7bAAAAAElFTkSuQmCC -->
					<span style="color:black;">Past Meals</span>
				</a>
				<p class="navbar-text navbar-right" style="margin-right:14px">
					<a href="/login" class="navbar-link" style="color:black">
						<span class="badge">Login</span></a></p>
			</div>
		</div>
	</nav>

	<div class="container">
		<table class="table table-striped" sortable="sortable">
			<thead>
				<tr>
					<th></th>
					<th>Foods</th>
					<th>Nutrition</th>
				</tr>
			</thead>

			<tbody>
				<col width="20%">
				<col width="40%">
				<col width="40%">
					
				{{#each users}} {{#if selected}}
					{{#if empty}}
						<tr>
							<td colspan="3" align="center">
								<h5 style="color:#8382BF;">No meals inputted yet. <a href="/">Add something?</a></h5>
							</td>
						</tr>
					{{else}}
						{{#each days}}
							<tr>
								<td colspan="3" align="center">
									<b>{{date}}</b>
								</td>
							</tr>
							{{#each meals}}
								<tr>
									<td>
										{{#if pic}}
											<br/> <img src="{{pic}}" class="img-responsive img-rounded" width="60" height="60">
										{{else}}
											<br/> <img src="http://thumbs.dreamstime.com/m/refresh-ccw-flat-black-color-rounded-vector-icon-symbol-drawn-light-gray-background-57876713.jpg" class="img-responsive img-rounded"
														width="60" height="60" onclick="window.alert('Do you wish to upload an image for this meal? Functionality coming soon...')">
										{{/if}}
									</td>

									<td>
										<!-- breakfast, lunch, etc. -->
										<u>{{time}}</u> <!-- <img src="http://i.imgur.com/Jka2XRv.png" height="15"> -->
											<!-- {if 1}} works? -->
											<br/> <b>{{servings1}}x</b> {{food1}}
										{{#if food2}}
											<br/> <b>{{servings2}}x</b> {{food2}}
										{{/if}}
										{{#if food3}}
											<br/> <b>{{servings3}}x</b> {{food3}}
										{{/if}}
										{{#if food4}}
											<br/> <b>{{servings4}}x</b> {{food4}}
										{{/if}}
									</td>

									<td id="{{date}}"> 
										<!-- data injected from js/history.js -->
										<div class="nutrition-info">
											<!-- divs to get info -->
											<div class="foods">
												<div class="{{food1}}">
													<div class="{{servings1}}"></div>
												</div>
												{{#if food2}}
													<div class="{{food2}}">
														<div class="{{servings2}}"></div>
													</div>
												{{/if}}
												{{#if food3}}
													<div class="{{food3}}">
														<div class="{{servings3}}"></div>
													</div>
												{{/if}}
												{{#if food4}}
													<div class="{{food4}}">
														<div class="{{servings4}}"></div>
													</div>
												{{/if}}
											</div>

											<!-- stuff to display: -->
											<b>Calories: </b>
											<div class="calories" style="display:inline;">0</div><br/>
											<b>Total Fat: </b>
											<div class="total_fat" style="display:inline;">0</div>g<br/>
											<b>Protein: </b>
											<div class="protein" style="display:inline;">0</div>g<br/>
											<b>Fiber: </b>
											<div class="fiber" style="display:inline;">0</div>g<br/>

											<!-- data["dishes"][0]["menu"][i]["name"] == req.params.id-->
										</div>
									</td>
								</tr>
							{{/each}}
						{{/each}}
					{{/if}}
				{{/if}} {{/each}}
			</tbody>
		</table>
	</div>

	{{> icon-panel}}

	<script src="js/jquery-1.11.0.js"></script>
	<script src="js/bootstrap.js"></script>
	<script src="js/history.js"></script>
	<script src="js/common.js"></script>
	<script>
		// document.getElementById("history-iconbar").setAttribute("class","btn btn-secondary btn-sm navbar-btn");
		// document.getElementById("history-link").setAttribute("href","#");
		
		var logged_in = false;
		{{#if guest}}
			// todo
			$(".navbar-link").attr("href", "/welcome");
			document.getElementsByClassName("badge")[0].innerHTML = "Signup";
		{{else}}
			{{#each users}}
				{{#if selected}}
					logged_in = true;
					document.getElementsByClassName("navbar-link")[0].innerHTML = "Not "+"{{name}}".split(" ")[0]+"?";
					$(".navbar-link").attr("onclick", "logout()");
					$(".navbar-link").attr("href", "");
				{{/if}}
			{{/each}}
		{{/if}}

		var msg = '<br/><h4 align="center">Please sign in to see your past meals.</h4>';
		if(!logged_in) document.getElementsByClassName("container")[0].innerHTML = msg;

		function logout() {
			$.get("/data/logout", refresh());
		}

		function refresh() {
			window.location.href = "/history";
		}
	</script>
</body>
</html>
