<!-- next: push, no popup if err, sessions -->

<!doctype html>

<html>
{{> html-header}}

<body>
	<!-- enter the page title between the partials -->
	{{> navbar}}
		<!-- voice input icon in a badge -->
		<!-- <span class="badge" data-toggle="modal" data-target="#popup" style="margin-right:5px;">
			<img src="http://uxrepo.com/download.php?img=static/icon-sets/google-material/svg/android-mic.svg" class="img-responsive" style="width:10px;">
		</span> -->

		Enter a Meal
	{{> navbar-hack}}

	<div class="container" align="center" style="padding-top:4px;">

		<br/>

		<!-- make it flash... -->
		<div id="corrections"></div>

		<form id="addMealForm" role="form" method="get" action="/history">
			<!-- make pic clickable to upload "new" image -->
			<div align="left">
				<div id="1" style="margin-bottom:15px;">
					<input class="foods" type="text" placeholder="Main Course" name="food1" style="margin-bottom:5px; width:130px;">
					<input type="number" placeholder="Servings" name="servings1" min="1" style="width:80px;">
					<span class="glyphicon glyphicon-question-sign" style="color:gray;" data-toggle="modal" data-target="#quaint"></span>

					<div id="2"></div>

					<span class="glyphicon glyphicon-plus-sign" style="color:orange; font-size:21px;" onClick="more()"></span>
					<p style="font-size:12px; display:inline;" id="plus-help-text">(choose more food items)</p>

					<!-- check if hidden element can be "clicked" -->
					<span id="minus-button" style="color:orange; font-size:21px;" class="glyphicon glyphicon-minus-sign" onClick="window.alert('todo: remove last food input field')"></span>
				</div>
				
				<input type="text" id="datepicker" placeholder="Date of Meal" name="date" style="margin-bottom:5px;">
				
				<br/>

				<select id="mealtype" name="t">
					<option value="Breakfast" selected>Breakfast</option>
					<option value="Brunch">Brunch</option>
					<option value="Lunch">Lunch</option>
					<option value="Dinner">Dinner</option>
					<option value="Snack">Snack</option>
				</select>
			</div>
			

			<div class="modal fade" id="popup-warn" {{> popup}}
				Warning
					</h4> </div> <div class="modal-body">
				The first item of this meal
				<br/><b class="list"><!--visible-->error: please enter a food first...</b>
				<br/>may cause you to consume excess of
				<br/><b>(Total) Fat</b>
				<br/><br/>
				Are you sure you want to add it?
					</div> <div class="modal-footer">
				<!-- doesn't serve the "purpose" -->
				<button type="button" class="btn btn-default" data-dismiss="modal">Choose something else</button>
				<input type="submit" id="submitBtn" class="btn btn-primary" value="Add anyway"></input>
			</div></div></div></div>

			<div class="modal fade" id="popup-conf" {{> popup}}
				Confirmation
					</h4> </div> <div class="modal-body">
				Good choice! The main course of this meal
				<br/><b class="list"><!--visible-->error: please enter a food first...</b>
				<br/>is pretty balanced in terms of nutrition.
				<br/><br/>
				Go ahead and log this meal?
					</div> <div class="modal-footer">
				<!-- doesn't serve the "purpose" -->
				<button type="button" class="btn btn-primary" data-dismiss="modal">Change something</button>
				<input type="submit" id="submitBtn" class="btn btn-default" value="Log this meal"></input>
			</div></div></div></div>
		</form>

		<br/>

		<!-- <input id="quantity" style="width:25px" maxlength="2" placeholder="x">
		<h5 style="display:inline;"> servings of </h5>
		<input id="tags" placeholder="food item"> -->

		<!-- The Original Fish Taco
		{{dishes.1.menu.0.name}} -->

		<div id="data"></div>

		<div id="stat" class="alert alert-info" role="alert">
			<div id="overlay" style="margin-bottom:-10px;">
				
				<h4 align="left">Daily Nutritional Progress</h4>
				
				<div class="progress"> calories
					<div class="progress-bar progress-bar-success" style="width: 0%;"></div>
				</div>
				
				<div class="progress"> total fat
					<div class="progress-bar progress-bar-success" style="width: 0%"></div>
				</div>
				
				<div class="progress"> protein
					<div class="progress-bar progress-bar-success" style="width: 0%"></div>
				</div>
				
				<div class="progress"> fiber
					<div class="progress-bar progress-bar-success" style="width: 0%"></div>
				</div>
			</div>
		</div>

		<!-- <h5 style="display:inline;">On </h5>
		<h5 style="display:inline;"> for </h5> -->

		<button type="button" id="add-meal-button" class="btn btn-primary btn-lg" data-toggle="modal" onClick="update()">Add Meal</button>

		<br/><br/>

		<!-- code for various popups follows; it may be moved anywhere (maybe) -->

		<div class="modal fade" id="popup" {{> popup}}
			Wizard of Oz
				</h4> </div> <div class="modal-body">
			Imagine such a <i>conversation</i> with your phone:
			<br/><br/>
			<b>What are you eating?</b>
			<br/>
			You: I'll probably have two servings of Teriyaki Chicken.
			<br/><br/>
			<b>It's very heavy on protein: try making it one serving.
			Otherwise, you may choose a healthier alternative, such as Potato Chicken.</b>
			<br/>
			You: Just add it anyway.
			<br/><br/>
			<b>Is this your meal for lunch today?</b>
			<br/>
			You: Yes.
			<br/><br/>
			<b>Your lunch has been input. <br/> Enjoy your meal!</b>
				</div> <div class="modal-footer">
			<button type="button" class="btn" data-dismiss="modal">Dismiss
		{{> popup-hack}}

		<div class="modal fade" id="quaint" {{> popup}}
			What is a serving?
				</h4> </div> <div class="modal-body">
			It corresponds to <b>how much a fast food restaurant serves you in its regular meals</b>.
			<br/><br/>
			For liquids, <i>1 serving = a small drink</i> (2 servings being a medium drink and so on).
				</div> <div class="modal-footer">
			<button type="button" class="btn" data-dismiss="modal">Dismiss
		{{> popup-hack}}

		<div class="modal fade" id="soon" {{> popup}}
			Coming soon...
				</h4> </div> <div class="modal-body">
			You will be able to upload an image (or click one).
				</div> <div class="modal-footer">
			<button type="button" class="btn" data-dismiss="modal">Dismiss
		{{> popup-hack}}

	</div>

	{{> icon-panel}}

	<!-- stylesheet for datepicker; dunno if this should be somewhere else, like in header, or if it conflicts w/ anything -->
	<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">

	<script src="js/jquery-1.11.0.js"></script>
	<script src="js/bootstrap.js"></script>

	<!-- from website for datepicker -->
	<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

	<!-- our custom scripts that are pretty long or used in multiple places -->
	<script src="js/nutrition-check.js"></script>

	<!-- datepicker script -->
	<script>
		window.mobilecheck = function() {
			var check = false;
			(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check = true})(navigator.userAgent||navigator.vendor||window.opera);
			if(!check)
				window.alert("Best viewed on mobile. Larger display support coming soon!");
		}
		window.onload = mobilecheck;

		$("#minus-button").hide();

		var availableFoods=["Chow Mein", "Chow Fun", "Fried Rice", "Brown Steamed Rice", "White Steamed Rice", "Mixed Vegetables", "Country Style Bean Curd", "Eggplant Tofu", "Hot Szechuan Tofu", "Black Pepper Chicken", "Kung Pao Chicken", "Grilled Teriyaki Chicken", "Grilled Asian Chicken", "Teriyaki Chicken", "Asian Chicken", "Mushroom Chicken", "Orange Chicken", "Potato Chicken", "Firecracker Chicken Breast", "String Bean Chicken Breast", "SweetFire Chicken Breast", "Sweet & Sour Chicken Breast", "Beijing Beef", "Broccoli Beef", "Shanghai Angus Steak", "Crispy Shrimp", "Honey Walnut Shrimp", "Golden Treasure Shrimp", "Steamed Ginger Fish", "Chicken Egg Roll", "Chicken Potsticker", "Cream Cheese Rangoon", "Vegetable Spring Roll", "Hot & Sour Soup", "Teriyaki Sauce", "Sweet & Sour Sauce", "Chili Sauce", "Soy Sauce", "Potsticker Sauce", "Fortune Cookies", "Chocolate Chip Chunk Cookie", "Pepsi", "Diet Pepsi", "Mountain Dew", "Dr. Pepper", "Mug Root Beer", "Sierra Mist", "Lipton No Calorie Brisk Peach", "Lipton Brisk Raspberry", "Sobe Lean", "Tropicana Fruit Punch", "Tropicana Lemonade", "Tropicana Pink Lemonade", "The Original Fish Taco", "The Coastal Trio", "Fish Taco Especial", "Smoky Oaxacan Shrimp Two Taco Plate", "Surf & Turf Two Taco Plate", "Salsa Verde Shrimp Taco", "Regal Springs Tilapia Taco", "Grilled Gourmet Taco with Shrimp", "Pacific Mahi Mahi Taco", "Atlantic Salmon Taco", "Grilled Shrimp & Bacon Burrito", "Smoky Oaxacan Shrimp Burrito", "Beer-battered Fish Burrito", "Langostino Lobster Burrito", "Cabo Plate", "Pacific Mahi Mahi Burrito", "Classic Grilled Shrimp Burrito", "Ancho Citrus Shrimp Burrito", "Atlantic Salmon Burrito", "Regal Springs Tilapia Burrito", "Chipotle Ranch Salad", "Chopped Salad", "Balsamic & Roasted Veggie Salad", "Chipotle Orange Salad", "California Bowl", "Classic Steak Taco", "Classic Chicken Taco", "Rubio's Grilled Steak Street Tacos", "Burrito Especial with Grilled Steak", "Burrito Especial with Grilled Chicken", "Chicken Tortilla Soup", "H-mex Burrito with Chicken", "Rubio's Grilled Chicken Street Tacos", "Baja Grill Burrito with Chicken", "Grilled Gourmet Taco with Steak", "Grilled Gourmet Taco with Chicken", "Baja Grill Burrito with Grilled Steak", "Burrito Especial with Veggies", "Bean & Cheese Burrito", "Grilled Gourmet Taco with Veggies", "Cheese Enchilada Plate with Fire-roasted Sauce", "Shrimp Enchilada Plate with Verde Sauce", "Chicken Enchilada Plate with Fire-roasted Sauce", "Langostino Lobster Enchilada Plate", "Cheese Nachos", "Chicken Nachos", "Cheese Quesadilla", "Chicken Quesadilla", "Kids Original Fish Taco without Salsa", "Kids Chicken Taco", "Kids Chicken Bites", "Kids Chicken Taquitos", "Kids Bean & Cheese Burrito", "Kids Chicken Quesadilla", "Kids Cheese Quesadilla", "Large Side of Citrus Rice", "Large Side of Mexican Rice", "Large Side of Black Beans", "Large Side of No-fried Pinto Beans", "Large Side of Tortilla Chips", "Regular Side of Citrus Rice", "Regular Side of Mexican Rice", "Regular Side of Black Beans", "Regular Side of No-fried Pinto Beans", "Regular Side of Tortilla Chips"];

		$(function() {
			$("#datepicker").datepicker();
			$(".foods").autocomplete({source: availableFoods});
			$(".foods").on("autocompletechange", function() { info("autocomplete change", 1); });
			// $(".foods").change(function() { info("manual typing change"); });
			$(".foods").change(function() { window.alert("Please choose a matching food from the options presented."); });
		});
		
		function update() {
			var f = document.forms["addMealForm"]["food1"].value;
			// console.log(f);
			if(f == "" || f == null){
				// random_color code courtesy of paulirish.com/2009/random-hex-color-code-snippets/
				var random_color = '#'+Math.floor(Math.random()*16777215).toString(16);
				document.getElementById("corrections").innerHTML = "Please enter a main course before trying to add a meal!<br/><br/>";
				document.getElementById("corrections").setAttribute("style","color:"+random_color+";");
			} else {
				$(".list").text(f);
			}
		}

		function more() {
			if(document.getElementById('2').innerHTML != "")
				if(document.getElementById('3').innerHTML != "")
					if(document.getElementById('4').innerHTML != "") {
						document.getElementById('5').innerHTML = 'Sorry! Limited to 4 food items per meal.';
						var random_color = '#'+Math.floor(Math.random()*16777215).toString(16);
						document.getElementById('5').setAttribute("style","margin-bottom:10px; color:"+random_color+";");
						return;
					}
			for(i=1; i<=4; i++) {
				if(document.getElementById(i).innerHTML == ""){
					// console.log("next food item is #"+i);
					var food_item = '<input class="foods" type="text" placeholder="Food Item #'+i+'" name="food'+i+'" style="margin-bottom:5px; margin-right:4px; width:130px;">';
					var servings = '<input type="number" placeholder="Servings" name="servings'+i+'" min="1" style="width:80px;">';
					// console.log(food_item +"\n"+ servings + '\n<div id="'+(i+1)+'"></div>');
					$("i").hide();
					document.getElementById(i).innerHTML = food_item + servings + '<div id="'+(i+1)+'"></div>';
					$("i").fadeIn();
					$(".foods").autocomplete({source: availableFoods});
					$(".foods").on("autocompletechange", function() { info("autocomplete change", i); });
					// $(".foods").change(function() { info("todo? manual typing change"); });
					$(".foods").change(function() { window.alert("Please choose a matching food from the options presented."); });

					$("#minus-button").fadeIn();
					$("#plus-help-text").hide();
					
					break;
				}
			}
		}
	
		document.getElementById("home-iconbar").setAttribute("class","btn btn-secondary btn-sm navbar-btn");
		document.getElementById("home-link").setAttribute("href","#");
	</script>
</body>
</html>
